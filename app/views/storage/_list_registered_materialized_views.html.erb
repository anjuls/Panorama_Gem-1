<%
@update_area = "list_materialized_views_detail_area_#{session[:request_counter]}"


def link_text(rec, value)
  my_ajax_link_to(value,
                  url_for(:action          => :list_registered_mview_query_text,
                          :mview_id        => rec.mview_id,
                          :update_area     => @update_area
                         ),
                  :title=>"Show query text of materialized view")
end


column_options =
  [
    {:caption=>"Owner",                 :data=>proc{|rec| rec.owner.downcase},                                :title=>"Owner of materialized view"},
    {:caption=>"Name",                  :data=>proc{|rec| link_text(rec, rec.name)},                          :title=>"Name of materialized view"},
    {:caption=>"Size (MB)",             :data=>proc{|rec| fn(rec.mbytes, 1)},                                 :title=>"Real current physical size of materialized view in MBytes (for local MViews only)", :align=>:right},
    {:caption=>"MView site",            :data=>proc{|rec| rec.mview_site},                                    :title=>"Global name of the materialized view site"},
    {:caption=>"Can use log",           :data=>proc{|rec| rec.can_use_log},                                   :title=>"YES if the materialized view can use a materialized view log, NO if the materialized view is too complex to use a log."},
    {:caption=>"Updatable",             :data=>proc{|rec| rec.updatable},                                     :title=>"(YES/NO) Indicates whether the materialized view is updatable. If set to NO, then the materialized view is read only."},
    {:caption=>"Fast refresh method",   :data=>proc{|rec| rec.refresh_method},                                :title=>"Whether the materialized view uses primary key, rowids, or object identifiers for fast refresh"},
    {:caption=>"ID",                    :data=>proc{|rec| rec.mview_id},                                      :title=>"Identifier for the materialized view used by the masters for fast refresh"},
    {:caption=>"Version",               :data=>proc{|rec| rec.version},                                       :title=>"Oracle version of the materialized view"},
    {:caption=>"Logs",                  :data=>proc{|rec| rec.snapshot_logs},                                 :title=>"Number of registered snapshot logs for this materialized view, if master site is this database"},
  ]

%>

<%= gen_slickgrid(@mvs, column_options, {
        :max_height => 450,
        :caption => "Data from sys.DBA_Registered_MViews"

}) %>

<div id="<%= @update_area %>" style="clear: both;">
</div>
